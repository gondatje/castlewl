<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CHS Itinerary — Exact Template Preview (Single File)</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--ink:#111;--muted:#666;--line:#e5e5e5;--paper:#fff;--bg:#f6f7f8}
    html,body{margin:0;padding:0;background:var(--bg);color:#111;font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1200px;margin:0 auto;padding:24px 24px 64px}
    h1{margin:0 0 8px;font-size:28px}
    p.lead{margin:0 0 16px;color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width: 1100px){.row{grid-template-columns:420px 1fr}}

    .ctl{border:1px solid var(--line);background:#fff;border-radius:14px;padding:12px}
    .section-title{font-size:12px;color:#333;margin:0 0 8px}
    .inp{border:1px solid var(--line);border-radius:10px;padding:8px 12px;font-size:14px}
    .btn{border:1px solid #d4d4d4;border-radius:10px;padding:8px 12px;background:#fff;cursor:pointer}
    .btn.primary{background:var(--ink);color:#fff;border-color:var(--ink)}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    /* guest pills */
    .pills{min-height:34px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-size:13px;transition:filter .15s ease}
    .pill .pill-x{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:50%;cursor:pointer;opacity:.9;transition:opacity .15s ease, filter .15s ease}
    .pill .pill-x svg{width:12px;height:12px;display:block}
    .pill .pill-x:hover{opacity:1;filter:brightness(0.92)}

    .cal{user-select:none}
    .cal-head{display:grid;grid-template-columns:auto 1fr auto auto;align-items:center;gap:8px}
    .cal-nav{display:flex;gap:6px}
    .cal-btn{padding:6px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer}
    .cal-title{text-align:center;font-weight:600}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px}
    .dow{font-size:11px;color:#777;text-align:center}
    .cal-cell{height:42px;display:flex;align-items:center;justify-content:center;border:1px solid #eee;border-radius:10px;cursor:pointer;background:#fff}
    .cal-cell.overflow{opacity:.45}
    .cal-cell.focused{outline:2px solid var(--ink)}
    .cal-cell.arr,.cal-cell.dep{background:var(--ink);color:#fff}
    .cal-cell.inrange{background:#f3f4f6;border-color:#e5e7eb}

    .doc-shell{background:#fff;width:8.5in;min-height:11in;margin:0 auto;padding:1in;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .doc-editable{outline:none;white-space:normal;font-size:12pt;line-height:1.5}

    @media print{
      body{background:#fff !important}
      .no-print{display:none !important}
      .doc-shell{box-shadow:none;width:auto;min-height:auto;margin:0;padding:.75in}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="no-print">
      <h1>CHS Itinerary — Exact Template Preview</h1>
      <p class="lead">Exact master copy • live names & dates • fixed calendar • print/copy.</p>
    </header>

    <div class="row">
      <!-- Controls -->
      <div class="stack">
        <div class="ctl">
          <div class="section-title">Guest(s)</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <input id="gf" class="inp" placeholder="First" />
            <input id="gl" class="inp" placeholder="Last" />
            <button id="addGuest" class="btn">Add Guest</button>
          </div>
          <div id="guestPills" class="pills" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>
        </div>

        <div class="ctl cal">
          <div class="cal-head">
            <div class="cal-nav">
              <button class="cal-btn" id="yPrev">«</button>
              <button class="cal-btn" id="mPrev">‹</button>
            </div>
            <div class="cal-title" id="calTitle">Month YYYY</div>
            <div class="cal-nav">
              <button class="cal-btn" id="mNext">›</button>
              <button class="cal-btn" id="yNext">»</button>
            </div>
            <div><button class="cal-btn" id="goToday">Today</button></div>
          </div>
          <div class="cal-grid" id="calGrid">
            <div class="dow">Sun</div><div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <button class="btn primary" id="setArr">Set Arrival</button>
            <button class="btn primary" id="setDep">Set Departure</button>
            <div style="font-size:13px;color:#333" id="arrDepView">Arrival: — | Departure: —</div>
          </div>
        </div>

        <div class="no-print" style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="printBtn">Print / Save PDF</button>
          <button class="btn" id="copyBtn">Copy as Text</button>
        </div>
      </div>

      <!-- Document Preview -->
      <div>
        <div class="doc-shell">
          <div id="doc" class="doc-editable" contenteditable="true"></div>
        </div>
      </div>
    </div>
  </div>
<script>
(function(){
  // ====================== MASTER TEMPLATE (verbatim) =======================
  const MASTER = `
{ STAY DATES ( Thursday, October 24 – Sunday, October 27) }

Dear {GUEST NAME},

We are delighted to welcome you to Castle Hot Springs! Our desert oasis of adventure, flavor, seclusion and relaxation await. We invite you to unwind in the natural hot springs, indulge in the flavors of the season at both Harvest Restaurant and Bar 1896, enjoy a massage alongside the natural spring creek, and experience an array of adventures and activities.

DINING

Explore your palate throughout the day with breakfast, lunch, and dinner — which is a unique multi-course tasting menu. Each meal will take you through a culinary experience of flavor combinations that will delight. There is a Grab n' Go coffee station beginning at 5:00AM; starting at 6:00AM parfaits (assorted toppings), granola bars and breakfast bread are available.

HARVEST
Breakfast | 7:00AM - 10:00AM
Lunch | 11:00AM - 2:00PM
Dinner | 5:30PM - 8:00PM
For dinner, reservations are required. Attire is elevated resort casual, no athletic-wear, please.

BAR 1896
Grab n’ Go | 6:00AM - 8:00AM
Lunch | 11:00AM - 2:00PM
Bistro Menu | 2:00PM - 9:00PM
á la carte | 5:30PM - 9:00PM
Cocktails | 11:00AM – Close

POOL SERVICE
Food Menu & Drinks 11:00AM – 4:30PM

IN-ROOM AMENITIES
Settle into your accommodations with well-appointed amenities. Your curated refreshments station includes a complimentary Nespresso machine, organic teas, local wines, drinks, snacks, and two 18oz YETI Rambler™ water bottles. Also enjoy an iPad with resort information, a Bose speaker, Wi-Fi, and convenient toiletries. To connect to Wi-Fi, select Castle Hot Springs Resort and enter the password RUsureUwant2?

ACTIVITIES, ADVENTURES & SPA
A multitude of ways to explore are available, guided and on your own. Please review the activity schedule, your itinerary, or visit the Activities Desk for more information. Wellness amenities and spa treatments are based on availability; inquire at the Front Desk. For these experiences, please consider functional clothing as you see fit.

If you need assistance or have questions, please call the Front Desk from your guestroom phone. Access to the hot springs is available 24/7 as is the cart service for ease of transport. We hope you have a wonderful time at our desert oasis!

Sincerely,
Castle Hot Springs Team

YOUR SCHEDULED ACTIVITIES

<div id="chs-activities-anchor"></div>

OASIS OF TIME – DOCUMENTARY RECEPTION
As an introduction to Castle Hot Springs, we welcome guests daily to our documentary reception. Released in 2019, this Emmy award-winning film “Oasis of Time” celebrates Castle Hot Springs’ extensive history that dates back over a century. Join us for a complimentary glass of wine at 4PM in the historic Stone House building as this inspiring 40-minute film walks you through our beautifully rich history. Please book your seat with the Front Desk.

BOUTIQUE & HISTORY ROOM
Experience the history of Castle Hot Springs with a stroll through our History Room, where collected artifacts, past amenities, and memorabilia are displayed for guests to learn from. The Boutique offers guests a curated selection of gifts, apparel, collectibles, and hand-crafted wellness products only found at Castle Hot Springs.
All Activities and Adventures require a prior reservation and are subject to change without notice. Cancellations of paid activities within 24 hours of the scheduled time or no-shows will be subject to 100% of the scheduled activity cost.`;

  // ============================ ELEMENTS ===================================
  const doc = document.getElementById('doc');
  const gf = document.getElementById('gf');
  const gl = document.getElementById('gl');
  const addGuestBtn = document.getElementById('addGuest');
  const guestPills = document.getElementById('guestPills');
  const calTitle = document.getElementById('calTitle');
  const calGrid = document.getElementById('calGrid');
  const yPrev = document.getElementById('yPrev');
  const yNext = document.getElementById('yNext');
  const mPrev = document.getElementById('mPrev');
  const mNext = document.getElementById('mNext');
  const goTodayBtn = document.getElementById('goToday');
  const setArrBtn = document.getElementById('setArr');
  const setDepBtn = document.getElementById('setDep');
  const arrDepView = document.getElementById('arrDepView');
  const printBtn = document.getElementById('printBtn');
  const copyBtn = document.getElementById('copyBtn');

  // ============================ STATE ======================================
  const guests = []; // {first,last}
  const today = new Date();
  let viewYear = today.getFullYear();
  let viewMonth = today.getMonth();
  let focusedIso = isoFromDate(today);
  let arrivalIso = '';
  let departureIso = '';

  const WEEKDAY = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const MONTH = ["January","February","March","April","May","June","July","August","September","October","November","December"];

  // ============================ INIT DOC ===================================
  function initDoc(){
    const html = MASTER
      .replace("{ STAY DATES ( Thursday, October 24 – Sunday, October 27) }", '<span data-ph="dates"></span>')
      .replace("Dear {GUEST NAME},", 'Dear <span data-ph="guest">{GUEST NAME}</span>,')
      .split("\n").map(l=> l.length? l : "&nbsp;").join("<br>");
    doc.innerHTML = html;
    requestAnimationFrame(rebuildDayHeaders);
  }

  // ============================ HELPERS ====================================
  function isoFromDate(d){const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const dd=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${dd}`}
  function dateFromIso(iso){if(!iso) return null; const [y,m,d]=iso.split('-').map(Number); return new Date(y,m-1,d)}
  function ordinal(n){const s=['th','st','nd','rd'],v=n%100;return s[(v-20)%10]||s[v]||s[0]}
  function fmtHuman(iso){if(!iso) return ''; const d=dateFromIso(iso); return `${WEEKDAY[d.getDay()]}, ${MONTH[d.getMonth()]} ${d.getDate()}${ordinal(d.getDate())}`}
  function fmtRange(a,b){if(!(a&&b)) return ''; const A=dateFromIso(a),B=dateFromIso(b); const S=(+A<=+B)?A:B; const E=(+A<=+B)?B:A; return `${WEEKDAY[S.getDay()]}, ${MONTH[S.getMonth()]} ${S.getDate()}${ordinal(S.getDate())} – ${WEEKDAY[E.getDay()]}, ${MONTH[E.getMonth()]} ${E.getDate()}${ordinal(E.getDate())}`}

  // ============================ CALENDAR ===================================
  function daysInMonth(y,m0){return new Date(y,m0+1,0).getDate()}
  function firstDow(y,m0){return new Date(y,m0,1).getDay()}
  function buildCells(y,m0){
    const dim=daysInMonth(y,m0), lead=firstDow(y,m0);
    const prevM=m0?m0-1:11, prevY=m0?y:y-1, dimPrev=daysInMonth(prevY,prevM);
    const cells=[];
    for(let i=lead;i>0;i--){const d=dimPrev-i+1; cells.push({iso:isoFromDate(new Date(prevY,prevM,d)),overflow:true});}
    for(let d=1;d<=dim;d++){cells.push({iso:isoFromDate(new Date(y,m0,d)),overflow:false});}
    while(cells.length<42){const idx=cells.length-lead-dim+1; const nextM=m0===11?0:m0+1; const nextY=m0===11?y+1:y; cells.push({iso:isoFromDate(new Date(nextY,nextM,idx)),overflow:true});}
    return cells;
  }

  function renderCalendar(){
    calTitle.textContent = `${MONTH[viewMonth]} ${viewYear}`;
    while(calGrid.children.length>7) calGrid.removeChild(calGrid.lastChild);
    const cells=buildCells(viewYear,viewMonth);
    const lowT=(arrivalIso&&departureIso)? Math.min(+dateFromIso(arrivalIso),+dateFromIso(departureIso)) : null;
    const highT=(arrivalIso&&departureIso)? Math.max(+dateFromIso(arrivalIso),+dateFromIso(departureIso)) : null;
    cells.forEach(({iso,overflow})=>{
      const d=dateFromIso(iso); const day=d.getDate(); const t=+d;
      const div=document.createElement('div');
      div.className='cal-cell'+(overflow?' overflow':'')
        +(iso===focusedIso?' focused':'')
        +(iso===arrivalIso?' arr':'')
        +(iso===departureIso?' dep':'')
        +((lowT!=null&&highT!=null&&t>lowT&&t<highT)?' inrange':'');
      div.textContent=String(day);
      div.title=fmtHuman(iso);
      div.addEventListener('click',()=>{focusedIso=iso; renderCalendar();});
      calGrid.appendChild(div);
    });
    arrDepView.textContent = `Arrival: ${fmtHuman(arrivalIso) || '—'} | Departure: ${fmtHuman(departureIso) || '—'}`;
  }

  function goMonth(delta){ let mm=viewMonth+delta, yy=viewYear; if(mm<0){mm=11;yy--} if(mm>11){mm=0;yy++} viewMonth=mm; viewYear=yy; renderCalendar(); }
  function goYear(delta){ viewYear+=delta; renderCalendar(); }
  function goToday(){ const d=new Date(); viewYear=d.getFullYear(); viewMonth=d.getMonth(); focusedIso=isoFromDate(d); renderCalendar(); }
  function setArrival(){ if(focusedIso){arrivalIso=focusedIso; updateDates();} }
  function setDeparture(){ if(focusedIso){departureIso=focusedIso; updateDates();} }

  function updateDates(){
    const root=doc; if(!root) return;
    const datesSpan=root.querySelector('span[data-ph="dates"]');
    if(datesSpan && arrivalIso && departureIso){ datesSpan.textContent = fmtRange(arrivalIso,departureIso); }
    rebuildDayHeaders();
    renderCalendar();
  }

  function rebuildDayHeaders(){
    const root=doc; if(!root) return;
    const anchor=root.querySelector('#chs-activities-anchor');
    if(!anchor) return;
    const parent=anchor.parentElement; if(!parent) return;
    let node=anchor.nextSibling;
    while(node){ const next=node.nextSibling; node.remove?.(); node=next; }
    if(!(arrivalIso&&departureIso)) return;

    const A=dateFromIso(arrivalIso), B=dateFromIso(departureIso);
    const S=(+A<=+B)?A:B, E=(+A<=+B)?B:A;
    for(let d=new Date(S); +d<=+E; d.setDate(d.getDate()+1)){
      parent.insertBefore(document.createElement('br'), anchor.nextSibling);
      const line=document.createElement('div');
      line.setAttribute('data-day','');
      line.textContent = WEEKDAY[d.getDay()]+',';
      parent.insertBefore(line, anchor.nextSibling);
      parent.insertBefore(document.createElement('br'), anchor.nextSibling);
    }
  }

  // ============================ GUESTS UI ==================================
  function shadeDarker(hex){
    const c=hex.replace('#','');
    const r=Math.max(0,Math.floor(parseInt(c.slice(0,2),16)*0.7));
    const g=Math.max(0,Math.floor(parseInt(c.slice(2,4),16)*0.7));
    const b=Math.max(0,Math.floor(parseInt(c.slice(4,6),16)*0.7));
    return `rgb(${r}, ${g}, ${b})`;
  }

  function refreshGuestsUI(){
    const colors=['#eef2ff','#ecfeff','#f0fdf4','#fff7ed','#fef9c3','#ffe4e6','#f5f3ff','#e0f2fe'];
    guestPills.innerHTML='';
    guests.forEach((g,idx)=>{
      const base=colors[idx%colors.length];
      const darker=shadeDarker(base);
      const pill=document.createElement('span');
      pill.className='pill';
      pill.style.background=base;
      pill.style.border=`1px solid ${darker}`;

      const label=document.createElement('span');
      label.textContent=g.first;

      const x=document.createElement('button');
      x.className='pill-x';
      x.title='Remove';
      x.setAttribute('aria-label','Remove');
      x.style.background=base;
      x.style.border=`1px solid ${darker}`;
      x.innerHTML = `<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <line x1="2" y1="2" x2="10" y2="10" stroke="${darker}" stroke-width="2.2" stroke-linecap="round"/>
        <line x1="10" y1="2" x2="2" y2="10" stroke="${darker}" stroke-width="2.2" stroke-linecap="round"/>
      </svg>`;
      x.addEventListener('click',()=>{ guests.splice(idx,1); refreshGuestsUI(); });

      pill.appendChild(label); pill.appendChild(x);
      guestPills.appendChild(pill);
    });

    const guestSpan=doc.querySelector('span[data-ph="guest"]');
    if(guestSpan){
      if(!guests.length){ guestSpan.textContent='{GUEST NAME}'; }
      else if(guests.length===1){ guestSpan.textContent=`${guests[0].first} ${guests[0].last}`; }
      else{
        const andJoin=(arr)=> arr.length<=1? (arr[0]||'') : arr.slice(0,-1).join(', ')+` and ${arr[arr.length-1]}`;
        const sameLast = new Set(guests.map(g=>g.last)).size===1;
        guestSpan.textContent = sameLast
          ? `${andJoin(guests.map(g=>g.first))} ${guests[0].last}`
          : andJoin(guests.map(g=>`${g.first} ${g.last}`));
      }
    }
  }

  function addGuest(){
    const first=(gf.value||'').trim();
    const last=(gl.value||'').trim();
    if(first&&last){
      guests.push({first,last});
      gf.value=''; gl.value='';
      refreshGuestsUI();
      gf.focus();
    }
  }

  // ============================ EVENTS =====================================
  addGuestBtn.addEventListener('click',addGuest);
  gl.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); addGuest(); gf.focus(); }});
  gf.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); gl.focus(); }});

  yPrev.addEventListener('click',()=>goYear(-1));
  yNext.addEventListener('click',()=>goYear(1));
  mPrev.addEventListener('click',()=>goMonth(-1));
  mNext.addEventListener('click',()=>goMonth(1));
  goTodayBtn.addEventListener('click',goToday);
  setArrBtn.addEventListener('click',setArrival);
  setDepBtn.addEventListener('click',setDeparture);

  printBtn.addEventListener('click',()=>window.print());
  copyBtn.addEventListener('click',()=>{
    const tmp = document.createElement('div');
    tmp.innerHTML = doc.innerHTML;
    tmp.querySelectorAll('br').forEach(br=>br.replaceWith('\n'));
    const text = tmp.textContent || '';
    navigator.clipboard.writeText(text);
  });

  // ============================ BOOT =======================================
  function init(){ initDoc(); renderCalendar(); }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }

})();
</script>
</body>
</html>
